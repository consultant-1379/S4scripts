#!/bin/bash

lms_ip=$1
wkl_vm_ip=$2
#netype=$3

workload_list=$3

#workload_list="AMOS_01 AMOS_02 AMOS_03 AMOS_04 AMOS_05 AMOS_08 AMOS_09 AP_01 AP_11 AP_12 AP_13 AP_14 AP_15 AP_16 AP_SETUP ASU_01 CELLMGT_01 CELLMGT_02 CELLMGT_07 CELLMGT_08 CELLMGT_09 CELLMGT_10 CELLMGT_11 CELLMGT_12 CELLMGT_13 CELLMGT_14 CELLMGT_15 CLI_MON_01 CLI_MON_02 CLI_MON_03 CMEVENTS_NBI_01 CMEXPORT_01 CMEXPORT_02 CMEXPORT_03 CMEXPORT_05 CMEXPORT_06 CMEXPORT_07 CMEXPORT_08 CMEXPORT_11 CMEXPORT_12 CMEXPORT_13 CMEXPORT_14 CMEXPORT_18 CMEXPORT_19 CMEXPORT_20 CMEXPORT_21 CMEXPORT_22 CMIMPORT_01 CMIMPORT_02 CMIMPORT_03 CMIMPORT_05 CMIMPORT_08 CMIMPORT_10 CMIMPORT_11 CMIMPORT_12 CMIMPORT_13 CMIMPORT_14 CMIMPORT_15 CMIMPORT_16 CMIMPORT_17 CMIMPORT_18 CMIMPORT_19 CMIMPORT_20 CMIMPORT_21 CMIMPORT_22 CMSYNC_02 CMSYNC_04 CMSYNC_06 CMSYNC_08 CMSYNC_09 CMSYNC_10 CMSYNC_11 CMSYNC_15 CMSYNC_19 CMSYNC_20 CMSYNC_25 CMSYNC_26 CMSYNC_28 CMSYNC_29 CMSYNC_30 CMSYNC_32 CMSYNC_35 CMSYNC_SETUP CONFIGURATION_TEMPLATE_01 CONFIGURATION_TEMPLATE_02 DOC_01 EBSL_01 EBSL_05 EBSL_06 EBSM_04 ENMCLI_01 ENMCLI_02 ENMCLI_03 ENMCLI_05 ENMCLI_06 ENMCLI_07 ESM_01 FMX_01 FMX_05 FM_01 FM_02 FM_03 FM_0506 FM_08 FM_09 FM_10 FM_11 FM_12 FM_14 FM_15 FM_17 FM_20 FM_21 FM_25 FM_26 FM_27 FM_30 HA_01 LAUNCHER_01 LAUNCHER_02 LAUNCHER_03 LOGVIEWER_01 NETEX_01 NETEX_02 NETEX_03 NETEX_04 NETEX_05 NETEX_06 NETEX_07 NETVIEW_01 NETVIEW_02 NETVIEW_SETUP NHC_01 NHC_02 NHC_03 NHM_01_02 NHM_04 NHM_05 NHM_06 NHM_07 NHM_08 NHM_09 NHM_10 NHM_11 NHM_12 NHM_13 NODECLI_01 NODESEC_15 OPS_01 PARMGT_01 PARMGT_02 PARMGT_03 PLM_01 PM_02 PM_03 PM_04 PM_11 PM_13 PM_15 PM_16 PM_17 PM_19 PM_20 PM_24 PM_25 PM_26 PM_27 PM_29 PM_30 PM_31 PM_32 PM_34 PM_38 PM_40 PM_42 PM_46 PM_47 PM_50 PM_51 PM_52 PM_55 PM_56 PM_57 PM_58 PM_59 PM_60 PM_61 PM_62 PM_63 PM_64 PM_65 PM_66 PM_67 PM_68 PM_69 PM_72 PM_73 PM_74 PM_75 PM_76 PM_77 PM_78 PM_79 PM_80 PM_81 PM_83 PM_84 PM_85 PM_86 PM_87 SECUI_01 SECUI_02 SECUI_03 SECUI_05 SECUI_06 SECUI_07 SECUI_08 SECUI_09 SECUI_10 SHM_01 SHM_02 SHM_03 SHM_04 SHM_05 SHM_06 SHM_07 SHM_19 SHM_20 SHM_21 SHM_23 SHM_27 SHM_28 SHM_31 SHM_32 SHM_33 SHM_34 SHM_35 SHM_36 SHM_37 SHM_39 SHM_SETUP TOP_01"
workload_status=$(sshpass -p 12shroot ssh nagios@$1 "sshpass -p 12shroot ssh root@$2 '/opt/ericsson/enmutils/bin/workload status --no-ansi'" | awk '{print $1}')
not_started=''

for workload in $workload_list
do
        if [[ $workload_status != *$workload* ]]; then
                not_started+=$workload" "
        fi
done
if [ ! -z "$not_started" ]; then
	echo "WARNING- THERE ARE WORKLOAD PROFILES WHICH ARE NOT STARTED:| $not_started"
	exit 1
fi

echo "OK- ALL WORKLOAD PROFILES ARE RUNNING" 
exit 0
